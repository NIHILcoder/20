# Детальная структура проекта VisioMera Evolution

Этот документ содержит подробное описание структуры проекта, включая взаимосвязи между компонентами, страницами и API.

## Корневой макет (`app/layout.tsx`)

**Основное назначение**: Определяет общую структуру HTML-документа для всех страниц приложения. Включает в себя основные навигационные компоненты и провайдеры контекста.

**Ключевые компоненты**:
- `AppSidebar` (`components/app-sidebar.tsx`) - Боковая панель навигации.
- `Header` (`components/header.tsx`) - Верхняя панель (шапка сайта).
- `BottomNav` (`components/bottom-nav.tsx`) - Нижняя панель навигации для мобильных устройств.

**Используемые контексты**:
- `ThemeProvider` (`contexts/theme-provider.tsx`) - Управляет темой приложения (светлая/темная).
- `AuthContext` (`contexts/auth-context.tsx`) - Предоставляет информацию о состоянии аутентификации пользователя.
- `LanguageContext` (`contexts/language-context.tsx`) - Управляет языком интерфейса.

## Основные страницы и их компоненты

### 1. Главная страница (`app/page.tsx`)

**Основное назначение**: Предоставление пользователю интерфейса для генерации изображений с помощью ИИ.

**Ключевые компоненты**:
- `ImprovedGenerationForm` (`components/improved-generation-form.tsx`) - Форма для ввода промптов и настроек генерации
- `EnhancedParticlesBackground` (`components/enhanced-particles-background.tsx`) - Анимированный фон страницы

**Используемые контексты**:
- `LanguageContext` - Для локализации интерфейса

### 2. Страница сообщества (`app/community/page.tsx`)

**Основное назначение**: Отображение работ пользователей, турниров и коллабораций.

**Ключевые компоненты**:
- `ArtworkGrid` (`components/community/artwork-grid.tsx`) - Сетка для отображения работ пользователей
- `CommunityFilters` (`components/community/community-filters.tsx`) - Фильтры для поиска и сортировки работ
- `Tournaments` (`components/community/tournaments.tsx`) - Отображение активных и прошедших турниров
- `Collaborations` (`components/community/collaborations.tsx`) - Отображение коллабораций между пользователями

**API маршруты**:
- `api/community/` - Получение данных сообщества

**Используемые модели**:
- `artwork.js` - Модель для работ пользователей
- `tournament.js` - Модель для турниров
- `collaboration.js` - Модель для коллабораций

### 3. Страница избранного (`app/favorites/page.tsx`)

**Основное назначение**: Управление коллекциями и избранными работами пользователя.

**Ключевые компоненты**:
- `CollectionsGrid` (`components/favorites/collections-grid.tsx`) - Сетка для отображения коллекций пользователя
- `CollectionItems` (`components/favorites/collection-items.tsx`) - Отображение элементов выбранной коллекции

**API маршруты**:
- `api/favorites/` - Управление избранными работами
- `api/collection/` - Управление коллекциями
- `api/collection-items/` - Управление элементами коллекций

**Используемые модели**:
- `collection.js` - Модель для коллекций

### 4. Страница промптов (`app/prompts/page.tsx`)

**Основное назначение**: Предоставление пользователям доступа к библиотеке промптов и управление ими.

**Ключевые компоненты**:
- `CommentsSection` (`components/prompts/comments-section.tsx`) - Секция для отображения и добавления комментариев
- `HierarchicalCategories` (`components/prompts/hierarchical-categories.tsx`) - Иерархическая структура категорий промптов
- `InfiniteScroll` (`components/prompts/infinite-scroll.tsx`) - Бесконечная прокрутка для загрузки промптов
- `PromptCollections` (`components/prompts/prompt-collections.tsx`) - Управление коллекциями промптов
- `PromptComments` (`components/prompts/prompt-comments.tsx`) - Компонент комментариев к промптам
- `TagsSelector` (`components/prompts/tags-selector.tsx`) - Выбор и управление тегами промптов

**API маршруты**:
- `api/prompts/` - Управление промптами и связанными данными

### 5. Страница обучения (`app/learning/page.tsx`)

**Основное назначение**: Предоставление обучающих материалов и руководств по использованию платформы.

**Ключевые компоненты**:
- В разработке

**Планируемый функционал**:
- Интерактивные уроки по работе с промптами
- Руководства по использованию различных функций платформы
- Советы по оптимизации результатов генерации

**Зависимости**:
- Требует авторизации пользователя (использует `AuthContext`)

### 4. Страница истории (`app/history/page.tsx`)

**Основное назначение**: Отображение истории генераций пользователя и статистики.

**Ключевые компоненты**:
- `HistoryList` (`components/history/history-list.tsx`) - Список генераций пользователя
- `GenerationStatistics` (`components/generation-statistics.tsx`) - Статистика по генерациям

**API маршруты**:
- `api/history/` - Получение истории генераций
- `api/statistics/` - Получение статистики

**Используемые модели**:
- `artwork.js` - Модель для работ пользователей

**Зависимости**:
- Требует авторизации пользователя (использует `AuthContext`)

### 5. Страница профиля (`app/profile/page.tsx`)

**Основное назначение**: Отображение и редактирование профиля пользователя.

**Ключевые компоненты**:
- `AvatarUpload` (`components/avatar-upload.tsx`) - Загрузка аватара пользователя

**API маршруты**:
- `api/user/` - Управление данными пользователя

**Используемые модели**:
- `user.js` - Модель пользователя

**Зависимости**:
- Требует авторизации пользователя (использует `AuthContext`)

## Общие компоненты и их использование

### Навигационные компоненты

- `AppSidebar` (`components/app-sidebar.tsx`) - Боковая панель навигации, используется на всех страницах в десктопной версии
- `BottomNav` (`components/bottom-nav.tsx`) - Нижняя панель навигации, используется на всех страницах в мобильной версии
- `Header` (`components/header.tsx`) - Верхняя панель с логотипом и основными действиями

### Контексты

- `AuthContext` (`components/auth-context.tsx`) - Контекст авторизации, предоставляет информацию о текущем пользователе
- `LanguageContext` (`components/language-context.tsx`) - Контекст локализации, предоставляет функции для перевода интерфейса
- `ThemeProvider` (`components/theme-provider.tsx`) - Провайдер темы, управляет темной/светлой темой

### Фоновые компоненты

- `ParticlesBackground` (`components/particles-background.tsx`) - Базовый компонент для анимированного фона
- `EnhancedParticlesBackground` (`components/enhanced-particles-background.tsx`) - Улучшенная версия с дополнительными эффектами

## Структура API

### Авторизация (`api/auth/`)

- Регистрация пользователей
- Вход в систему
- Выход из системы
- Восстановление пароля

### Пользователи (`api/user/`)

- Получение данных пользователя
- Обновление профиля
- Изменение пароля
- Загрузка аватара

### Сообщество (`api/community/`)

- Получение работ пользователей
- Фильтрация и поиск работ
- Управление турнирами
- Управление коллаборациями

### Коллекции (`api/collection/`)

- Создание коллекций
- Редактирование коллекций
- Удаление коллекций

### Элементы коллекций (`api/collection-items/`)

- Добавление работ в коллекции
- Удаление работ из коллекций

### История (`api/history/`)

- Получение истории генераций
- Фильтрация и поиск по истории

### Статистика (`api/statistics/`)

- Получение статистики по генерациям
- Получение статистики по использованию системы

## Взаимодействие компонентов

1. **Форма генерации → История**
   - После генерации изображения, результат сохраняется в истории пользователя
   - Пользователь может просмотреть историю на странице истории

2. **История → Избранное**
   - Пользователь может добавить работу из истории в избранное или коллекцию
   - Работа появляется на странице избранного

3. **Сообщество → Профиль**
   - При клике на автора работы в сообществе, пользователь переходит на страницу профиля автора

4. **Профиль → Сообщество**
   - На странице профиля отображаются работы пользователя, которые также видны в сообществе

## Схема базы данных

### Основные таблицы

- **users** - Пользователи системы
- **artworks** - Работы (генерации) пользователей
- **collections** - Коллекции работ
- **collection_items** - Связь между коллекциями и работами
- **comments** - Комментарии к работам
- **likes** - Лайки работ
- **follows** - Подписки между пользователями
- **tags** - Теги для работ
- **artwork_tags** - Связь между работами и тегами
- **notifications** - Уведомления пользователей
- **sessions** - Сессии пользователей

### Связи между таблицами

- **users** → **artworks** (один ко многим): Пользователь может иметь много работ
- **users** → **collections** (один ко многим): Пользователь может иметь много коллекций
- **collections** → **collection_items** (один ко многим): Коллекция может содержать много элементов
- **artworks** → **collection_items** (один ко многим): Работа может быть в нескольких коллекциях
- **users** → **comments** (один ко многим): Пользователь может оставить много комментариев
- **artworks** → **comments** (один ко многим): К работе может быть много комментариев
- **users** → **likes** (один ко многим): Пользователь может поставить много лайков
- **artworks** → **likes** (один ко многим): У работы может быть много лайков
- **users** → **follows** (многие ко многим): Пользователи могут подписываться друг на друга
- **artworks** → **artwork_tags** (один ко многим): Работа может иметь много тегов
- **tags** → **artwork_tags** (один ко многим): Тег может быть у многих работ

## Примечание

Для визуализации структуры проекта используйте:
- `project-structure.puml` - PlantUML диаграмма структуры проекта
- `project-structure-table.md` - Таблица с основными компонентами и их связями